<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NFG ‚Äî Login</title>
  <link rel="icon" type="image/png" href="/assets/icons/icon-192.png">
  
  <!-- PWA Support -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0D47A1">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NFG">
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            nfgblue: '#0D47A1',
            nfgdark: '#0A3A84',
            nfglight: '#E3ECFA',
            nfgray: '#E5E7EB',
            nftext: '#1E293B',
            nfbg: '#F8FAFC'
          },
          fontFamily: { inter: ['Inter', 'sans-serif'] },
          borderRadius: { xl: '12px' },
          boxShadow: { nfg: '0 4px 14px rgba(13,71,161,0.06)' }
        }
      }
    }
  </script>
</head>
<body class="bg-nfbg font-inter flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-nfg rounded-xl border border-nfgray p-8 w-full max-w-md">
    <h1 class="text-2xl font-semibold text-nfgblue text-center mb-2">NFG Dashboard</h1>
    <p class="text-center text-sm text-nftext mb-6">Sign in to manage bookings, jobs, and reports.</p>

    <form id="login-form" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-nftext mb-1">Email</label>
        <input type="email" name="email" class="w-full border border-nfgray rounded-xl p-2.5 focus:ring-2 focus:ring-nfgblue outline-none" placeholder="you@company.com" required />
      </div>
      <div>
        <label class="block text-sm font-medium text-nftext mb-1">Password</label>
        <input type="password" name="password" class="w-full border border-nfgray rounded-xl p-2.5 focus:ring-2 focus:ring-nfgblue outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
      </div>
      <button type="submit" class="w-full bg-nfgblue hover:bg-nfgdark text-white rounded-xl py-2.5 font-medium transition">Sign In</button>
      <p id="auth-error" class="text-red-600 text-center text-sm hidden"></p>
    </form>

    <div class="mt-6 border-t border-nfgray pt-4 text-center space-y-2">
      <p class="text-sm text-gray-600">
        Don't have an account? 
        <a href="./signup.html" class="text-nfgblue hover:text-nfgdark font-medium">Sign Up</a>
      </p>
      <button id="signup-demo" class="text-gray-500 hover:text-gray-700 text-xs">or create a demo account</button>
    </div>
  </div>

  <script type="module" src="./js/supabase.js"></script>
  <script type="module" src="./js/auth.js"></script>
  
  <!-- Login Form Handler -->
  <script type="module">
    import { supabase } from './js/supabase.js'
    
    const form = document.getElementById('login-form')
    const errorEl = document.getElementById('auth-error')
    const demoBtn = document.getElementById('signup-demo')
    
    console.log('üîê Initializing login form...')
    console.log('üìã Form element:', form ? 'Found' : 'Not found')
    
    form?.addEventListener('submit', async (e) => {
      e.preventDefault()
      console.log('üìù Form submitted')
      
      const formData = new FormData(form)
      const email = formData.get('email')
      const password = formData.get('password')
      
      console.log('üìß Email:', email)
      console.log('üîë Password:', password ? '***' : 'empty')
      
      // Hide previous errors
      errorEl.classList.add('hidden')
      errorEl.textContent = ''
      
      // Disable submit button
      const submitBtn = form.querySelector('button[type="submit"]')
      submitBtn.disabled = true
      submitBtn.textContent = 'Signing in...'
      
      try {
        console.log('üì§ Attempting sign in...')
        const { data, error } = await supabase.auth.signInWithPassword({ 
          email, 
          password 
        })
        
        console.log('üì• Sign in response:', { data, error })
        
        if (error) {
          console.error('‚ùå Sign in error:', error)
          errorEl.textContent = error.message || 'Failed to sign in. Please check your credentials.'
          errorEl.classList.remove('hidden')
          throw error
        }
        
        console.log('‚úÖ Sign in successful, redirecting to dashboard...')
        window.location.href = './dashboard.html'
      } catch (error) {
        console.error('‚ùå Login failed:', error)
      } finally {
        submitBtn.disabled = false
        submitBtn.textContent = 'Sign In'
      }
    })
    
    // Demo account creation
    demoBtn?.addEventListener('click', async () => {
      console.log('üéÆ Creating demo account...')
      const email = `demo+${Date.now()}@nfg.test`
      const password = 'Demo123!'
      
      try {
        const { data, error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            data: {
              full_name: 'Demo User',
              role: 'client'
            }
          }
        })
        
        if (error) throw error
        
        console.log('‚úÖ Demo account created, signing in...')
        await supabase.auth.signInWithPassword({ email, password })
        window.location.href = './dashboard.html'
      } catch (error) {
        console.error('‚ùå Demo account creation failed:', error)
        errorEl.textContent = error.message || 'Failed to create demo account'
        errorEl.classList.remove('hidden')
      }
    })
    
    console.log('‚úÖ Login form initialized')
  </script>
  
  <!-- PWA Installation -->
  <script type="module" src="./js/pwa.js"></script>
</body>
</html>


