<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NFG ‚Äî Login</title>
  <link rel="icon" type="image/png" href="https://zqcbldgheimqrnqmbbed.supabase.co/storage/v1/object/sign/app-images/NFG%20one.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV8xN2RmNDhlMi0xNGJlLTQ5NzMtODZlNy0zZTc0MjgzMWIzOTQiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhcHAtaW1hZ2VzL05GRyBvbmUucG5nIiwiaWF0IjoxNzYyOTc5NzU5LCJleHAiOjQ4ODUwNDM3NTl9.fnJIDQep2yYlgGKlBRNnkrUoUzXzG7eac39GG6NQPuU">
  
  <!-- PWA Support -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0D47A1">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NFG">
  <link rel="apple-touch-icon" href="https://zqcbldgheimqrnqmbbed.supabase.co/storage/v1/object/sign/app-images/NFG%20one.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV8xN2RmNDhlMi0xNGJlLTQ5NzMtODZlNy0zZTc0MjgzMWIzOTQiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhcHAtaW1hZ2VzL05GRyBvbmUucG5nIiwiaWF0IjoxNzYyOTc5NzU5LCJleHAiOjQ4ODUwNDM3NTl9.fnJIDQep2yYlgGKlBRNnkrUoUzXzG7eac39GG6NQPuU">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            nfgblue: '#0D47A1',
            nfgdark: '#0A3A84',
            nfglight: '#E3ECFA',
            nfgray: '#E5E7EB',
            nftext: '#1E293B',
            nfbg: '#F8FAFC'
          },
          fontFamily: { inter: ['Inter', 'sans-serif'] },
          borderRadius: { xl: '12px' },
          boxShadow: { nfg: '0 4px 14px rgba(13,71,161,0.06)' }
        }
      }
    }
  </script>
</head>
<body class="bg-nfbg font-inter flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-nfg rounded-xl border border-nfgray p-8 w-full max-w-md">
    <!-- Logo (will be updated by branding system) -->
    <div class="text-center mb-4">
      <img 
        src="https://zqcbldgheimqrnqmbbed.supabase.co/storage/v1/object/sign/app-images/Untitled%20design.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV8xN2RmNDhlMi0xNGJlLTQ5NzMtODZlNy0zZTc0MjgzMWIzOTQiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhcHAtaW1hZ2VzL1VudGl0bGVkIGRlc2lnbi5wbmciLCJpYXQiOjE3NjQ5NzExMTUsImV4cCI6NDg4NzAzNTExNX0.gLGPNDBFahGt3_dmWSFIny3YZbuU3eWBA86Gnu2Umpw" 
        alt="handl.it" 
        class="h-12 mx-auto mb-2 company-logo"
        data-branding="logo"
      />
    </div>
    <h1 class="text-2xl font-semibold text-nfgblue text-center mb-2">
      <span class="company-name" data-branding="name">handl.it</span> Dashboard
    </h1>
    <p class="text-center text-sm text-nftext mb-6">Sign in to manage bookings, jobs, and reports.</p>

    <form id="login-form" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-nftext mb-1">Email</label>
        <input type="email" name="email" class="w-full border border-nfgray rounded-xl p-2.5 focus:ring-2 focus:ring-nfgblue outline-none" placeholder="you@company.com" required />
      </div>
      <div>
        <label class="block text-sm font-medium text-nftext mb-1">Password</label>
        <input type="password" name="password" class="w-full border border-nfgray rounded-xl p-2.5 focus:ring-2 focus:ring-nfgblue outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
      </div>
      <button type="submit" class="w-full bg-nfgblue hover:bg-nfgdark text-white rounded-xl py-2.5 font-medium transition">Sign In</button>
      <p id="auth-error" class="text-red-600 text-center text-sm hidden"></p>
    </form>

    <!-- Social Sign In -->
    <div class="mt-6">
      <div class="relative flex items-center justify-center my-4">
        <div class="h-px bg-nfgray w-full"></div>
        <span class="absolute bg-white px-3 text-xs text-gray-500">or continue with</span>
      </div>
      <div class="grid grid-cols-1 gap-3">
        <button id="google-signin" type="button" class="w-full border border-nfgray rounded-xl py-2.5 text-sm font-medium flex items-center justify-center gap-2 hover:bg-nfglight/40 transition">
          <img src="https://zqcbldgheimqrnqmbbed.supabase.co/storage/v1/object/sign/app-images/google-logo-png-webinar-optimizing-for-success-google-business-webinar-13.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV8xN2RmNDhlMi0xNGJlLTQ5NzMtODZlNy0zZTc0MjgzMWIzOTQiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhcHAtaW1hZ2VzL2dvb2dsZS1sb2dvLXBuZy13ZWJpbmFyLW9wdGltaXppbmctZm9yLXN1Y2Nlc3MtZ29vZ2xlLWJ1c2luZXNzLXdlYmluYXItMTMucG5nIiwiaWF0IjoxNzYzMzI0MDc5LCJleHAiOjMzMjY3Nzg4MDc5fQ.yz-31Wo7nyjNYRK9PCx9MlRVxvPk0OorVVvR37ly_cY" alt="Google logo" class="w-5 h-5 object-contain" />
          <span>Google</span>
        </button>
        <button id="microsoft-signin" type="button" class="w-full border border-nfgray rounded-xl py-2.5 text-sm font-medium flex items-center justify-center gap-2 hover:bg-nfglight/40 transition">
          <img src="https://zqcbldgheimqrnqmbbed.supabase.co/storage/v1/object/sign/app-images/microsoft-color.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV8xN2RmNDhlMi0xNGJlLTQ5NzMtODZlNy0zZTc0MjgzMWIzOTQiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhcHAtaW1hZ2VzL21pY3Jvc29mdC1jb2xvci5wbmciLCJpYXQiOjE3NjMzMjQzODcsImV4cCI6MzE3MDkxNzg4Mzg3fQ.9NIa6u9LYaULMsaXl5HkFzGE7-Tkef3o2iobyVOiPBw" alt="Microsoft logo" class="w-5 h-5 object-contain" />
          <span>Microsoft</span>
        </button>
      </div>
    </div>

    <div class="mt-6 border-t border-nfgray pt-4 text-center space-y-2">
      <p class="text-sm text-gray-600">
        Don't have an account? 
        <a href="./signup.html" class="text-nfgblue hover:text-nfgdark font-medium">Sign Up</a>
      </p>
      <button id="signup-demo" class="text-gray-500 hover:text-gray-700 text-xs">or create a demo account</button>
    </div>
  </div>

  <script type="module" src="./js/supabase.js"></script>
  <script type="module" src="./js/auth.js"></script>
  <script type="module" src="./js/client-auth.js"></script>
  <script type="module" src="./js/branding.js"></script>
  
  <!-- Login Form Handler -->
  <script type="module">
    import { supabase } from './js/supabase.js'
    
    const form = document.getElementById('login-form')
    const errorEl = document.getElementById('auth-error')
    const demoBtn = document.getElementById('signup-demo')
    const googleBtn = document.getElementById('google-signin')
    const msBtn = document.getElementById('microsoft-signin')
    
    console.log('üîê Initializing login form...')
    console.log('üìã Form element:', form ? 'Found' : 'Not found')
    
    form?.addEventListener('submit', async (e) => {
      e.preventDefault()
      console.log('üìù Form submitted')
      
      const formData = new FormData(form)
      const email = formData.get('email')
      const password = formData.get('password')
      
      console.log('üìß Email:', email)
      console.log('üîë Password:', password ? '***' : 'empty')
      
      // Hide previous errors
      errorEl.classList.add('hidden')
      errorEl.textContent = ''
      
      // Disable submit button
      const submitBtn = form.querySelector('button[type="submit"]')
      submitBtn.disabled = true
      submitBtn.textContent = 'Signing in...'
      
      try {
        console.log('üì§ Attempting sign in...')
        const { data, error } = await supabase.auth.signInWithPassword({ 
          email, 
          password 
        })
        
        console.log('üì• Sign in response:', { data, error })
        
        if (error) {
          console.error('‚ùå Sign in error:', error)
          errorEl.textContent = error.message || 'Failed to sign in. Please check your credentials.'
          errorEl.classList.remove('hidden')
          throw error
        }
        
        console.log('‚úÖ Sign in successful, redirecting based on role...')
        const { checkClientAuth } = await import('./js/client-auth.js')
        await checkClientAuth()
      } catch (error) {
        console.error('‚ùå Login failed:', error)
      } finally {
        submitBtn.disabled = false
        submitBtn.textContent = 'Sign In'
      }
    })
    
    // Social Sign-in: Google
    googleBtn?.addEventListener('click', async () => {
      try {
        const { error } = await supabase.auth.signInWithOAuth({
          provider: 'google',
          options: { redirectTo: `${window.location.origin}/index.html` }
        })
        if (error) throw error
      } catch (err) {
        console.error('Google sign-in error:', err)
        if (errorEl) {
          errorEl.textContent = 'Google sign-in failed. Please try again.'
          errorEl.classList.remove('hidden')
        }
      }
    })
    
    // Social Sign-in: Microsoft (Azure)
    msBtn?.addEventListener('click', async () => {
      try {
        const { error } = await supabase.auth.signInWithOAuth({
          provider: 'azure',
          options: { redirectTo: `${window.location.origin}/index.html` }
        })
        if (error) throw error
      } catch (err) {
        console.error('Microsoft sign-in error:', err)
        if (errorEl) {
          errorEl.textContent = 'Microsoft sign-in failed. Please try again.'
          errorEl.classList.remove('hidden')
        }
      }
    })
    
    // Demo account creation
    demoBtn?.addEventListener('click', async () => {
      console.log('üéÆ Creating demo account...')
      const email = `demo+${Date.now()}@nfg.test`
      const password = 'Demo123!'
      
      try {
        const { data, error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            data: {
              full_name: 'Demo User',
              role: 'client'
            }
          }
        })
        
        if (error) throw error
        
        console.log('‚úÖ Demo account created, signing in...')
        await supabase.auth.signInWithPassword({ email, password })
        const { checkClientAuth } = await import('./js/client-auth.js')
        await checkClientAuth()
      } catch (error) {
        console.error('‚ùå Demo account creation failed:', error)
        errorEl.textContent = error.message || 'Failed to create demo account'
        errorEl.classList.remove('hidden')
      }
    })
    
    console.log('‚úÖ Login form initialized')
  </script>
  
  <!-- PWA Installation -->
  <script type="module" src="./js/pwa.js"></script>
</body>
</html>


